#!/bin/bash

# Compile the modified SNMP daemon.
g++ snmpd.cpp -std=c++17 ../net-snmp-5.9.1/agent/.libs/libnetsnmpagent.so -lnetsnmp -lm -lssl -lcrypto -o snmpd
if [ $? -ne 0 ]; then exit; fi

# Version information.
./snmpd --version | awk 'NF'
#if [ $? -ne 0 ]; then exit; fi

# Set the MIB file.
export MIBDIRS=~/.snmp/mibs
export MIBS=NTCIP1203-v0305

TOID=shortErrorStatus.0
echo -n "$TOID is "
snmptranslate -IR -On shortErrorStatus.0

echo Starting SNMP daemon
# Man pages: http://www.net-snmp.org/docs/man/
LISTENER=udp:6161
LISTENER=tcp:127.0.0.1:2161
LISTENER=udp:161
sudo ./snmpd -a -c ~/.snmp/snmpd.conf -C -d -f -M $MIBDIRS -m $MIBS -V -D $LISTENER

